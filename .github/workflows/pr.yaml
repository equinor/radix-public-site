name: radix-public-site-pr
permissions:
  contents: read
on:
  pull_request:
    branches:
      - main
jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4
      - name: Build docker image
        env:
          REF: ${{ github.sha }}
        run: docker build -t radix-public-site:${REF##*/} .

  validate-radixconfig:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4
      - uses: equinor/radix-github-actions@v2
      - name: "Validate public-site"
        run: rx validate radix-config --config-file radixconfig.yaml
      - name: "Validate oauth example radix-app"
        run: rx validate radix-config --config-file examples/radix-example-oauth-proxy/radixconfig.yaml
      - name: "Validate keda service bus example radix-app"
        run: rx validate radix-config --config-file examples/radix-example-keda-servicebus/radixconfig.yaml
      - name: "Validate keda event hub example radix-app"
        run: rx validate radix-config --config-file examples/radix-example-keda-eventhub/radixconfig.yaml

  test-plugin:
    name: Test MkDocs Plugin
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: Install uv
        uses: astral-sh/setup-uv@d0cc045d04ccac9d8b7881df0226f9e82c39688e # @v6.8.0

      - name: Run plugin tests
        run:  uv run python ./scripts/test_plugin.py

      - name: validate mkdocs urls
        run:  uv run mkdocs build --strict